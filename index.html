<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Keuangan Keluarga</title>

<link rel="manifest" href="manifest.json">
<link rel="icon" href="icon192.png">
<meta name="theme-color" content="#0f172a">
<meta name="apple-mobile-web-app-capable" content="yes">

<style>
:root{
  --bg:#0f172a;
  --card:#1e293b;
  --input:#020617;
  --text:#e5e7eb;
  --muted:#94a3b8;
  --green:#22c55e;
  --red:#ef4444;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:system-ui,sans-serif;
  background:var(--bg);
  color:var(--text);
  padding:14px;
}

.container{max-width:420px;margin:auto}

h2{margin-bottom:10px}

.card{
  background:var(--card);
  border-radius:14px;
  padding:12px;
  margin-bottom:12px;
}

input,select,textarea,button{
  width:100%;
  padding:10px 12px;
  border-radius:10px;
  border:none;
  margin-top:6px;
}

input,select,textarea{
  background:var(--input);
  color:var(--text);
}

button{
  background:var(--green);
  font-weight:700;
  cursor:pointer;
}

.row{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:8px;
}

.small{font-size:12px;color:var(--muted)}

.list-item{
  display:flex;
  justify-content:space-between;
  gap:10px;
}

.amount.plus{color:var(--green)}
.amount.minus{color:var(--red)}

.actions{
  display:flex;
  gap:6px;
  margin-top:6px;
}
.actions button{
  padding:6px;
  font-size:12px;
}
</style>
</head>

<body>
<div class="container">

<h2>üí∞ Keuangan Keluarga</h2>

<!-- INPUT -->
<div class="card">
  <input id="date" type="date">

  <select id="type">
    <option value="income">Pemasukan</option>
    <option value="expense">Pengeluaran</option>
    <option value="adjust">Penyesuaian</option>
  </select>

  <input id="category" placeholder="Kategori (Makan, Tagihan, dll)">

  <input id="amount" type="number" placeholder="Nominal (Rp)">

  <textarea id="note" rows="2" placeholder="Catatan (opsional)"></textarea>

  <button onclick="saveTx()">+ Simpan</button>
</div>

<!-- SUMMARY -->
<div class="card">
  <b>Saldo:</b>
  <div style="font-size:20px;margin:6px 0" id="balance">Rp 0</div>
  <div class="small">
    + Masuk: <span id="sumIn">0</span><br>
    - Keluar: <span id="sumOut">0</span>
  </div>
</div>

<!-- HISTORY -->
<div class="card">
  <b>Histori</b>
  <div id="list"></div>
</div>

</div>

<script>
date.valueAsDate = new Date();

let data = JSON.parse(localStorage.getItem("familyMoney")) || [];
let editIndex = null;

function saveTx(){
  if(amount.value <= 0){
    alert("Nominal wajib diisi");
    return;
  }

  const tx = {
    date: date.value,
    type: type.value,
    category: category.value || "-",
    amount: +amount.value,
    note: note.value
  };

  if(editIndex !== null){
    data[editIndex] = tx;
    editIndex = null;
  } else {
    data.unshift(tx);
  }

  localStorage.setItem("familyMoney", JSON.stringify(data));
  resetForm();
  render();
}

function resetForm(){
  category.value = amount.value = note.value = "";
  date.valueAsDate = new Date();
}

function editTx(i){
  const t = data[i];
  date.value = t.date;
  type.value = t.type;
  category.value = t.category;
  amount.value = t.amount;
  note.value = t.note;
  editIndex = i;
  window.scrollTo({top:0,behavior:"smooth"});
}

function delTx(i){
  if(confirm("Hapus data?")){
    data.splice(i,1);
    localStorage.setItem("familyMoney", JSON.stringify(data));
    render();
  }
}

function render(){
  list.innerHTML="";
  let bal=0,income=0,expense=0;

  data.forEach((t,i)=>{
    if(t.type==="income"){bal+=t.amount;income+=t.amount;}
    if(t.type==="expense"){bal-=t.amount;expense+=t.amount;}
    if(t.type==="adjust"){bal+=t.amount;}

    list.innerHTML+=`
      <div class="list-item">
        <div>
          <b>${t.category}</b>
          <div class="small">${t.date}</div>
        </div>
        <div style="text-align:right">
          <div class="amount ${t.type!=="expense"?"plus":"minus"}">
            ${t.type==="expense"?"-":"+"}${t.amount.toLocaleString()}
          </div>
          <div class="actions">
            <button onclick="editTx(${i})">‚úèÔ∏è</button>
            <button onclick="delTx(${i})">üóë</button>
          </div>
        </div>
      </div>
      <hr style="opacity:.1">
    `;
  });

  balance.textContent = "Rp " + bal.toLocaleString();
  sumIn.textContent = income.toLocaleString();
  sumOut.textContent = expense.toLocaleString();
}

render();
</script>

<script>
if("serviceWorker" in navigator){
  navigator.serviceWorker.register("sw.js");
}
</script>
</body>
</html>
