<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Uang Keluarga</title>

<link rel="manifest" href="manifest.json">
<link rel="icon" href="icon192.png">
<meta name="theme-color" content="#f59e0b">

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,sans-serif;
  background:#fff7ed;
  color:#1f2937;
}
header{
  text-align:center;
  padding:14px;
  font-size:18px;
  font-weight:700;
  background:#fff;
  border-bottom:1px solid #e5e7eb;
}
.container{
  max-width:480px;
  margin:auto;
  padding:14px;
  padding-bottom:90px;
}
.card{
  background:#fff;
  border-radius:16px;
  padding:14px;
  margin-bottom:12px;
  box-shadow:0 4px 14px rgba(0,0,0,.06);
}
label{font-size:12px;color:#6b7280}
input,textarea,select{
  width:100%;
  padding:10px 12px;
  border-radius:10px;
  border:1px solid #e5e7eb;
  margin-bottom:10px;
  font-size:14px;
}
.amount{font-size:18px;font-weight:700}
button{
  border:none;
  border-radius:10px;
  padding:10px;
  font-weight:700;
  cursor:pointer;
}
.toggle{
  display:flex;
  gap:8px;
  margin-bottom:10px;
}
.toggle button{
  flex:1;
  background:#fde68a;
  color:#92400e;
}
.toggle button.active{
  background:#f59e0b;
  color:#fff;
}

/* History */
.row{
  display:flex;
  justify-content:space-between;
  gap:10px;
}
.left .date{font-size:11px;color:#9ca3af}
.left .note{font-size:16px;font-weight:600}
.left .cat{
  font-size:11px;
  background:#fde68a;
  padding:2px 8px;
  border-radius:999px;
  display:inline-block;
}
.right{text-align:right}
.right .amt{font-size:16px;font-weight:700}
.right .actions button{
  padding:4px 6px;
  font-size:12px;
  margin-left:4px;
  background:#e5e7eb;
}

/* Nav */
.nav{
  position:fixed;
  bottom:0;
  left:0;
  right:0;
  display:flex;
  background:#fff;
  border-top:2px solid #e5e7eb;
}
.nav button{
  flex:1;
  padding:12px;
  background:none;
  border:none;
  font-weight:600;
  color:#6b7280;
}
.nav button.active{
  color:#f59e0b;
  border-top:3px solid #f59e0b;
}
.hidden{display:none}
.empty{
  text-align:center;
  color:#9ca3af;
  padding:40px 0;
}
</style>
</head>

<body>
<header>üí∞ Uang Keluarga</header>

<div class="container">

<!-- TAB INPUT -->
<div id="tabInput">
  <div class="card">
    <label>Tanggal</label>
    <input type="date" id="date">

    <div class="toggle">
      <button id="btnOut" class="active" onclick="setType('out')">Pengeluaran</button>
      <button id="btnIn" onclick="setType('in')">Pemasukan</button>
    </div>

    <label>Catatan</label>
    <textarea id="note" rows="2"></textarea>

    <label>Nominal</label>
    <input id="amount" type="number" class="amount">

    <label>Kategori</label>
    <select id="category">
      <option>Makan</option>
      <option>Transport</option>
      <option>Rumah</option>
      <option>Anak</option>
      <option>Pemasukan</option>
      <option>Lainnya</option>
    </select>

    <button style="background:#f59e0b;color:#fff" onclick="save()">Simpan</button>
  </div>
</div>

<!-- TAB RIWAYAT -->
<div id="tabHistory" class="hidden">
  <div id="historyList"></div>
</div>

<!-- TAB INSIGHT -->
<div id="tabInsight" class="hidden">
  <div class="card" id="insightBox"></div>
</div>

</div>

<div class="nav">
  <button class="active" onclick="switchTab('input',this)">Input</button>
  <button onclick="switchTab('history',this)">Riwayat</button>
  <button onclick="switchTab('insight',this)">Insight</button>
</div>

<!-- FIREBASE -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getFirestore, collection, addDoc,
  onSnapshot, doc, deleteDoc, updateDoc
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "ISI_API_KEY_MU",
  authDomain: "keuangan-keluarga.firebaseapp.com",
  projectId: "keuangan-keluarga"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const ref = collection(db,"keluarga");

window.addDoc = addDoc;
window.updateDoc = updateDoc;
window.deleteDoc = deleteDoc;
window.doc = doc;
window.ref = ref;

let data = [];
onSnapshot(ref,snap=>{
  data = snap.docs.map(d=>({id:d.id,...d.data()}));
  renderAll();
});
</script>

<script>
let type="out", editId=null;
date.valueAsDate=new Date();

function autoCategory(t){
  t=t.toLowerCase();
  if(/makan|kopi|ayam|nasi/.test(t)) return "Makan";
  if(/bensin|ojek|parkir/.test(t)) return "Transport";
  if(/listrik|air|internet/.test(t)) return "Rumah";
  if(/anak|susu|popok/.test(t)) return "Anak";
  if(/gaji|thr|jual/.test(t)) return "Pemasukan";
  return "Lainnya";
}
note.oninput=()=>category.value=autoCategory(note.value);

function setType(t){
  type=t;
  btnIn.classList.remove("active");
  btnOut.classList.remove("active");
  (t==="in"?btnIn:btnOut).classList.add("active");
}

async function save(){
  if(!amount.value) return alert("Nominal wajib diisi");
  const payload={
    date:date.value,
    note:note.value,
    category:category.value,
    type,
    amount:+amount.value,
    ts:Date.now()
  };
  if(editId){
    await updateDoc(doc(ref,editId),payload);
    editId=null;
  }else{
    await addDoc(ref,payload);
  }
  reset();
}

function reset(){
  note.value="";
  amount.value="";
  category.value="Lainnya";
  date.valueAsDate=new Date();
  setType("out");
}

function renderHistory(){
  historyList.innerHTML="";
  if(!data.length){
    historyList.innerHTML=`<div class="empty">Belum ada transaksi</div>`;
    return;
  }
  data.sort((a,b)=>b.ts-a.ts).forEach(t=>{
    historyList.innerHTML+=`
    <div class="card row">
      <div class="left">
        <div class="date">${t.date}</div>
        <div class="note">${t.note||"-"}</div>
        <div class="cat">${t.category}</div>
      </div>
      <div class="right">
        <div class="amt">${t.type==="out"?"-":"+"}${t.amount.toLocaleString()}</div>
        <div class="actions">
          <button onclick="edit('${t.id}')">‚úèÔ∏è</button>
          <button onclick="del('${t.id}')">üóë</button>
        </div>
      </div>
    </div>`;
  });
}

function edit(id){
  const t=data.find(x=>x.id===id);
  editId=id;
  date.value=t.date;
  note.value=t.note;
  amount.value=t.amount;
  category.value=t.category;
  setType(t.type);
  switchTab('input',document.querySelector('.nav button'));
}

async function del(id){
  if(confirm("Hapus transaksi ini?")){
    await deleteDoc(doc(ref,id));
  }
}

function renderInsight(){
  let inc=0,exp=0;
  data.forEach(t=>t.type==="in"?inc+=t.amount:exp+=t.amount);
  insightBox.innerHTML=`
    <b>Pemasukan:</b> Rp ${inc.toLocaleString()}<br>
    <b>Pengeluaran:</b> Rp ${exp.toLocaleString()}<br>
    <hr>
    <b>Saldo:</b> Rp ${(inc-exp).toLocaleString()}
  `;
}

function renderAll(){
  renderHistory();
  renderInsight();
}

function switchTab(tab,btn){
  document.querySelectorAll(".nav button").forEach(b=>b.classList.remove("active"));
  btn.classList.add("active");
  tabInput.classList.toggle("hidden",tab!=="input");
  tabHistory.classList.toggle("hidden",tab!=="history");
  tabInsight.classList.toggle("hidden",tab!=="insight");
}
</script>
</body>
</html>
